"""
Offline Mode Support for Vaani
Ensures essential functionality works without internet connection
"""

import os
import json
import hashlib
from datetime import datetime
import logging

# Configure logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    filename='offline_mode.log'
)

logger = logging.getLogger('offline_mode')

class OfflineMode:
    def __init__(self, cache_dir="offline_cache"):
        """Initialize the offline mode manager with cache directory"""
        self.cache_dir = cache_dir
        self.ensure_cache_dir()
        self.services = {
            "financial": self.get_financial_cache_file(),
            "emergency": self.get_emergency_cache_file(),
            "agriculture": self.get_agriculture_cache_file(),
            "schemes": self.get_schemes_cache_file(),
            "calculator": self.get_calculator_cache_file()
        }
        
    def ensure_cache_dir(self):
        """Ensure the cache directory exists"""
        if not os.path.exists(self.cache_dir):
            os.makedirs(self.cache_dir)
            logger.info(f"Created cache directory: {self.cache_dir}")
    
    def is_online(self):
        """Check if internet connection is available"""
        try:
            # Try to connect to Google DNS to check internet
            import socket
            socket.create_connection(("8.8.8.8", 53), timeout=3)
            return True
        except OSError:
            return False
    
    def get_cache_path(self, service):
        """Get the cache file path for a specific service"""
        return os.path.join(self.cache_dir, f"{service}_cache.json")
    
    def load_cache(self, service):
        """Load cached data for a service"""
        cache_path = self.get_cache_path(service)
        if os.path.exists(cache_path):
            try:
                with open(cache_path, 'r', encoding='utf-8') as f:
                    return json.load(f)
            except json.JSONDecodeError:
                logger.error(f"Error decoding cache file: {cache_path}")
                return {}
        return {}
    
    def save_cache(self, service, data):
        """Save data to cache for a service"""
        cache_path = self.get_cache_path(service)
        try:
            with open(cache_path, 'w', encoding='utf-8') as f:
                json.dump(data, f, ensure_ascii=False, indent=2)
            logger.info(f"Updated cache for {service}")
            return True
        except Exception as e:
            logger.error(f"Error saving cache for {service}: {str(e)}")
            return False
    
    def get_response(self, service, query, online_function=None):
        """
        Get response from cache or online function
        
        Args:
            service: Service type (financial, emergency, etc)
            query: The user's query
            online_function: Function to call if online
            
        Returns:
            Response text and whether it came from cache
        """
        # First check if we're online and can use the online function
        if self.is_online() and online_function:
            try:
                response = online_function(query)
                
                # Save successful response to cache
                if response:
                    cache = self.load_cache(service)
                    query_hash = hashlib.md5(query.encode()).hexdigest()
                    
                    cache[query_hash] = {
                        "query": query,
                        "response": response,
                        "timestamp": datetime.now().isoformat()
                    }
                    
                    # Find similar queries to link together
                    for existing_hash, data in list(cache.items()):
                        if self.query_similarity(query, data["query"]) > 0.7:
                            cache[existing_hash]["similar_to"] = query_hash
                    
                    self.save_cache(service, cache)
                    return response, False  # False = not from cache
                
            except Exception as e:
                logger.error(f"Error with online function: {str(e)}")
                # Fall back to cache on error
        
        # If offline or online function failed, try to find in cache
        cache = self.load_cache(service)
        if not cache:
            return self.get_fallback_response(service, query), True
        
        # Try exact match first
        query_hash = hashlib.md5(query.encode()).hexdigest()
        if query_hash in cache:
            return cache[query_hash]["response"], True
        
        # Try similarity matching
        best_match = None
        best_score = 0.6  # Minimum similarity threshold
        
        for item_hash, data in cache.items():
            similarity = self.query_similarity(query, data["query"])
            if similarity > best_score:
                best_match = item_hash
                best_score = similarity
        
        if best_match:
            return cache[best_match]["response"], True
            
        # No match found, return fallback response
        return self.get_fallback_response(service, query), True
    
    def query_similarity(self, query1, query2):
        """Calculate simple similarity between two queries"""
        # Simple implementation using set similarity
        # For production, use a more sophisticated algorithm
        words1 = set(query1.lower().split())
        words2 = set(query2.lower().split())
        
        if not words1 or not words2:
            return 0.0
            
        intersection = len(words1.intersection(words2))
        union = len(words1.union(words2))
        
        return intersection / union if union > 0 else 0.0
    
    def get_fallback_response(self, service, query):
        """Get a fallback response when no cache is available"""
        fallbacks = {
            "financial": "рдореБрдЭреЗ рдЦреЗрдж рд╣реИ, рдЗрд╕ рдкреНрд░рд╢реНрди рдХрд╛ рдЙрддреНрддрд░ рдСрдлрд▓рд╛рдЗрди рдореЛрдб рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред рдХреГрдкрдпрд╛ рдЗрдВрдЯрд░рдиреЗрдЯ рдХрдиреЗрдХреНрд╢рди рд╣реЛрдиреЗ рдкрд░ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред",
            "emergency": "рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдирдВрдмрд░: рдкреБрд▓рд┐рд╕: 100, рдПрдореНрдмреБрд▓реЗрдВрд╕: 108, рдЖрдЧ: 101, рдорд╣рд┐рд▓рд╛ рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди: 1091",
            "agriculture": "рдореБрдЭреЗ рдЦреЗрдж рд╣реИ, рдлрд╕рд▓ рд╕рдВрдмрдВрдзреА рдЬрд╛рдирдХрд╛рд░реА рдСрдлрд▓рд╛рдЗрди рдореЛрдб рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред рдХреГрдкрдпрд╛ рдЗрдВрдЯрд░рдиреЗрдЯ рдХрдиреЗрдХреНрд╢рди рд╣реЛрдиреЗ рдкрд░ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред",
            "schemes": "рдореБрдЭреЗ рдЦреЗрдж рд╣реИ, рдпреЛрдЬрдирд╛ рд╕рдВрдмрдВрдзреА рдЬрд╛рдирдХрд╛рд░реА рдСрдлрд▓рд╛рдЗрди рдореЛрдб рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред рдХреГрдкрдпрд╛ рдЗрдВрдЯрд░рдиреЗрдЯ рдХрдиреЗрдХреНрд╢рди рд╣реЛрдиреЗ рдкрд░ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред",
            "calculator": "рдореБрдЭреЗ рдЦреЗрдж рд╣реИ, рдЗрд╕ рдЧрдгрдирд╛ рдХрд╛ рдЙрддреНрддрд░ рдСрдлрд▓рд╛рдЗрди рдореЛрдб рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред"
        }
        return fallbacks.get(service, "рдЗрдВрдЯрд░рдиреЗрдЯ рдХрдиреЗрдХреНрд╢рди рди рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред")
    
    # Pre-cached content files
    def get_financial_cache_file(self):
        """Get or create financial literacy cache file"""
        cache_path = self.get_cache_path("financial")
        if not os.path.exists(cache_path):
            basic_financial = {
                hashlib.md5("рдмреИрдВрдХ рдореЗрдВ рдЦрд╛рддрд╛ рдХреИрд╕реЗ рдЦреЛрд▓реЗрдВ".encode()).hexdigest(): {
                    "query": "рдмреИрдВрдХ рдореЗрдВ рдЦрд╛рддрд╛ рдХреИрд╕реЗ рдЦреЛрд▓реЗрдВ",
                    "response": """рдмреИрдВрдХ рдореЗрдВ рдЦрд╛рддрд╛ рдЦреЛрд▓рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИред
рдкрд╣рд▓рд╛ рдХрджрдо: рдмреИрдВрдХ рдореЗрдВ рдЬрд╛рдирд╛ рдФрд░ рдкреВрдЫрдирд╛
рдкрд╣рд▓реЗ рдХреНрдпрд╛ рдХрд░реЗрдВ: рдЕрдкрдиреЗ рдШрд░ рдХреЗ рдкрд╛рд╕ рдХрд┐рд╕реА рдмреИрдВрдХ рдореЗрдВ рдЬрд╛рдУред рдмреИрдВрдХ рдХреА рдкрд╣рдЪрд╛рди рд╣реИ рдХрд┐ рд╡рд╣рд╛рдВ рд▓реЛрдЧ рдкреИрд╕реЗ рдЬрдорд╛ рдХрд░рддреЗ рдФрд░ рдирд┐рдХрд╛рд▓рддреЗ рд╣реИрдВред
рдлрд┐рд░ рдХреНрдпрд╛ рдХрд░реЗрдВ: рдмреИрдВрдХ рдХреЗ рдмрд╛рд╣рд░ рдпрд╛ рдЕрдВрджрд░ рддреБрдореНрд╣реЗрдВ рдХреЛрдИ рд╡рд░реНрджреА рд╡рд╛рд▓рд╛ рдЖрджрдореА (рдЧрд╛рд░реНрдб) рдпрд╛ рдХреЛрдИ рдмреИрдВрдХ рдХрд╛ рдХрд░реНрдордЪрд╛рд░реА рдорд┐рд▓реЗрдЧрд╛ред рдЙрд╕рд╕реЗ рд╣рд╛рде рдЬреЛрдбрд╝рдХрд░ рдХрд╣реЛ, "рдирдорд╕реНрддреЗ! рдореБрдЭреЗ рдЕрдкрдирд╛ рдкреИрд╕рд╛ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЦрд╛рддрд╛ рдЦреБрд▓рд╡рд╛рдирд╛ рд╣реИред"
рдЖрдЦрд┐рд░ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛрдЧрд╛: рд╡реЛ рддреБрдореНрд╣реЗрдВ рдХрд┐рд╕реА рдЕрдзрд┐рдХрд╛рд░реА рдпрд╛ рдХрд░реНрдордЪрд╛рд░реА рдХреЗ рдкрд╛рд╕ рднреЗрдЬ рджреЗрдВрдЧреЗ, рдЬреЛ рдЦрд╛рддрд╛ рдЦреЛрд▓рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред

рджреВрд╕рд░рд╛ рдХрджрдо: рдЦрд╛рддрд╛ рдЦреЛрд▓рдиреЗ рд╡рд╛рд▓рд╛ рдХрд╛рдЧрдЬрд╝ (рдлрд╝реЙрд░реНрдо) рд▓реЗрдирд╛ рдФрд░ рдорджрдж рдорд╛рдВрдЧрдирд╛
рдкрд╣рд▓реЗ рдХреНрдпрд╛ рдХрд░реЗрдВ: рдЬрд┐рд╕ рдЕрдзрд┐рдХрд╛рд░реА рдХреЗ рдкрд╛рд╕ рддреБрдореНрд╣реЗрдВ рднреЗрдЬрд╛ рдЧрдпрд╛ рд╣реИ, рдЙрд╕рд╕реЗ рдХрд╣реЛ, "рдореБрдЭреЗ рдЦрд╛рддрд╛ рдЦреЛрд▓рдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ рдХрд╛рдЧрдЬрд╝ рдЪрд╛рд╣рд┐рдПред"
рдлрд┐рд░ рдХреНрдпрд╛ рдХрд░реЗрдВ: рдЕрдЧрд░ рддреБрдореНрд╣реЗрдВ рдкрдврд╝рдирд╛-рд▓рд┐рдЦрдирд╛ рдирд╣реАрдВ рдЖрддрд╛, рддреЛ рдШрдмрд░рд╛рдирд╛ рдирд╣реАрдВред рдЙрд╕реА рдЕрдзрд┐рдХрд╛рд░реА рд╕реЗ рдпрд╛ рдХрд┐рд╕реА рдФрд░ рднрд░реЛрд╕реЗрдордВрдж рдмреИрдВрдХ рдХрд░реНрдордЪрд╛рд░реА рд╕реЗ рдХрд╣реЛ, "рднреИрдпрд╛/рдмрд╣рдирдЬреА, рдореБрдЭреЗ рдпрд╣ рдХрд╛рдЧрдЬрд╝ рднрд░рдирд╛ рдирд╣реАрдВ рдЖрддрд╛, рдХреНрдпрд╛ рдЖрдк рдореЗрд░реА рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ?"
рдЖрдЦрд┐рд░ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛрдЧрд╛: рдмреИрдВрдХ рдХрд░реНрдордЪрд╛рд░реА рддреБрдореНрд╣рд╛рд░реА рдмрд╛рддреЛрдВ рдХреЛ рд╕реБрдирдХрд░ рд╡рд╣ рдХрд╛рдЧрдЬрд╝ рднрд░ рджреЗрдВрдЧреЗред

рддреАрд╕рд░рд╛ рдХрджрдо: рдЕрдкрдиреА рдкрд╣рдЪрд╛рди рдХреЗ рдХрд╛рдЧрдЬрд╝ рджреЗрдирд╛
рдкрд╣рд▓реЗ рдХреНрдпрд╛ рдХрд░реЗрдВ: рдХрд╛рдЧрдЬрд╝ рднрд░рддреЗ рд╕рдордп, рд╡реЗ рддреБрдорд╕реЗ рддреБрдореНрд╣рд╛рд░реА рдкрд╣рдЪрд╛рди рдХрд╛ рдХреЛрдИ рдХрд╛рдЧрдЬрд╝ (рдЬреИрд╕реЗ рдЖрдзрд╛рд░ рдХрд╛рд░реНрдб, рд╡реЛрдЯрд░ рдЖрдИрдбреА) рдФрд░ рддреБрдореНрд╣рд╛рд░реЗ рдШрд░ рдХреЗ рдкрддреЗ рдХрд╛ рдХреЛрдИ рдХрд╛рдЧрдЬрд╝ рдорд╛рдВрдЧреЗрдВрдЧреЗред рдпреЗ рдХрд╛рдЧрдЬрд╝ рдЙрдирдХреЗ рдкрд╛рд╕ рдЬрдорд╛ рдХрд░рд╡рд╛рдУред
рдлрд┐рд░ рдХреНрдпрд╛ рдХрд░реЗрдВ: рд╡реЗ рддреБрдореНрд╣рд╛рд░реЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ (рдЕрдЧрд░ рддреБрдо рдЕрдВрдЧреВрдард╛ рд▓рдЧрд╛рддреЗ рд╣реЛ, рддреЛ рдЕрдВрдЧреВрдареЗ рдХрд╛ рдирд┐рд╢рд╛рди) рд▓реЗрдВрдЧреЗред рдмреИрдВрдХ рдХрд░реНрдордЪрд╛рд░реА рддреБрдореНрд╣реЗрдВ рдмрддрд╛рдПрдБрдЧреЗ рдХрд┐ рдХрд╣рд╛рдБ рдирд┐рд╢рд╛рди рд▓рдЧрд╛рдирд╛ рд╣реИред
рдЖрдЦрд┐рд░ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛрдЧрд╛: рдмреИрдВрдХ рдХреЗ рдкрд╛рд╕ рддреБрдореНрд╣рд╛рд░реА рдкрд╣рдЪрд╛рди рдФрд░ рдкрддреЗ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдкрд╣реБрдБрдЪ рдЬрд╛рдПрдЧреАред

рдЪреМрдерд╛ рдХрджрдо: рдЕрдкрдиреЗ рдЦрд╛рддреЗ рдореЗрдВ рдкреИрд╕реЗ рдЬрдорд╛ рдХрд░рдирд╛
рдкрд╣рд▓реЗ рдХреНрдпрд╛ рдХрд░реЗрдВ: рдЕрдм рддреБрдореНрд╣реЗрдВ рдЕрдкрдиреЗ рдирдП рдЦрд╛рддреЗ рдореЗрдВ рдкрд╣рд▓реА рдмрд╛рд░ рдХреБрдЫ рдкреИрд╕реЗ рдЬрдорд╛ рдХрд░рдиреЗ рд╣реЛрдВрдЧреЗред рдпреЗ рдкреИрд╕реЗ рддреБрдореНрд╣рд╛рд░реЗ рдЕрдкрдиреЗ рд╣реИрдВред рддреБрдо тВ╣100 рдпрд╛ рдЬрд┐рддрдиреЗ рднреА рдкреИрд╕реЗ рдЪрд╛рд╣реЛ, рдЬрдорд╛ рдХрд░ рд╕рдХрддреЗ рд╣реЛред
рдлрд┐рд░ рдХреНрдпрд╛ рдХрд░реЗрдВ: рдмреИрдВрдХ рддреБрдореНрд╣реЗрдВ рдПрдХ рдЫреЛрдЯреА рд╕реА рдХрд┐рддрд╛рдм рджреЗрдВрдЧреЗ рдЬрд┐рд╕реЗ 'рдкрд╛рд╕рдмреБрдХ' рдХрд╣рддреЗ рд╣реИрдВред рдЗрд╕рдореЗрдВ рддреБрдореНрд╣рд╛рд░реЗ рдЬрдорд╛ рдХрд┐рдП рдЧрдП рдкреИрд╕реЗ рдФрд░ рдирд┐рдХрд╛рд▓реЗ рдЧрдП рдкреИрд╕реЛрдВ рдХрд╛ рд╣рд┐рд╕рд╛рдм рд▓рд┐рдЦрд╛ рд╣реЛрдЧрд╛ред
рдЖрдЦрд┐рд░ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛрдЧрд╛: рддреБрдореНрд╣рд╛рд░реЗ рдкреИрд╕реЗ рдмреИрдВрдХ рдореЗрдВ рд╕реБрд░рдХреНрд╖рд┐рдд рдЬрдорд╛ рд╣реЛ рдЬрд╛рдПрдБрдЧреЗ рдФрд░ рддреБрдореНрд╣реЗрдВ рдЙрдирдХреА рдкрд╛рд╕рдмреБрдХ рдореЗрдВ рдПрдВрдЯреНрд░реА рдорд┐рд▓ рдЬрд╛рдПрдЧреАред

рдкрд╛рдВрдЪрд╡рд╛рдВ рдХрджрдо: рддреБрдореНрд╣рд╛рд░рд╛ рдЦрд╛рддрд╛ рдЦреБрд▓ рдЧрдпрд╛!
рдЖрдЦрд┐рд░ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛрдЧрд╛: рдмрд╕! рдЕрдм рддреБрдореНрд╣рд╛рд░рд╛ рдмреИрдВрдХ рдореЗрдВ рдЦрд╛рддрд╛ рдЦреБрд▓ рдЧрдпрд╛ рд╣реИред рддреБрдо рдХрднреА рднреА рдмреИрдВрдХ рдЖрдХрд░ рдЕрдкрдиреЗ рдкреИрд╕реЗ рдЬрдорд╛ рдХрд░ рд╕рдХрддреЗ рд╣реЛ рдФрд░ рдЬрдм рдЬрд╝рд░реВрд░рдд рд╣реЛ, рддрдм рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реЛред рдмреИрдВрдХ рддреБрдореНрд╣рд╛рд░реЗ рдкреИрд╕реЛрдВ рдХрд╛ рдзреНрдпрд╛рди рд░рдЦреЗрдЧрд╛ред рдпрд╣ рд▓реЛ, рддреБрдореНрд╣рд╛рд░рд╛ рдмреИрдВрдХ рдЦрд╛рддрд╛ рдЦреБрд▓ рдЧрдпрд╛! рдмрдзрд╛рдИ рд╣реЛ!""",
                    "timestamp": datetime.now().isoformat()
                },
                hashlib.md5("ATM рд╕реЗ рдкреИрд╕реЗ рдХреИрд╕реЗ рдирд┐рдХрд╛рд▓реЗрдВ".encode()).hexdigest(): {
                    "query": "ATM рд╕реЗ рдкреИрд╕реЗ рдХреИрд╕реЗ рдирд┐рдХрд╛рд▓реЗрдВ",
                    "response": """ATM рд╕реЗ рдкреИрд╕реЗ рдирд┐рдХрд╛рд▓рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИред
рдкрд╣рд▓рд╛ рдХрджрдо: ATM рдвреВрдВрдврдирд╛
рдкрд╣рд▓реЗ рдХреНрдпрд╛ рдХрд░реЗрдВ: рдЕрдкрдиреЗ рдмреИрдВрдХ рдХрд╛ ATM рдвреВрдВрдвреЗрдВред рдпреЗ рдПрдХ рдЫреЛрдЯреЗ рдХрдорд░реЗ рдЬреИрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдорд╢реАрди рд▓рдЧреА рд╣реЛрддреА рд╣реИред
рдлрд┐рд░ рдХреНрдпрд╛ рдХрд░реЗрдВ: ATM рдХреЗ рдЕрдВрджрд░ рдЬрд╛рдПрдВред рдЕрдХреЗрд▓реЗ рдЬрд╛рдирд╛ рд╕рдмрд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИред
рдЖрдЦрд┐рд░ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛрдЧрд╛: рдЖрдк ATM рдорд╢реАрди рдХреЗ рд╕рд╛рдордиреЗ рдЦрдбрд╝реЗ рд╣реЛ рдЬрд╛рдПрдВрдЧреЗред

рджреВрд╕рд░рд╛ рдХрджрдо: рдЕрдкрдирд╛ рдХрд╛рд░реНрдб рдбрд╛рд▓рдирд╛
рдкрд╣рд▓реЗ рдХреНрдпрд╛ рдХрд░реЗрдВ: рдЕрдкрдирд╛ ATM рдХрд╛рд░реНрдб рдирд┐рдХрд╛рд▓реЗрдВред
рдлрд┐рд░ рдХреНрдпрд╛ рдХрд░реЗрдВ: ATM рдорд╢реАрди рдореЗрдВ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдЫрд┐рджреНрд░ рджрд┐рдЦреЗрдЧрд╛ рдЬрд╣рд╛рдВ рддреАрд░ рдХрд╛ рдирд┐рд╢рд╛рди рдмрдирд╛ рд╣реЛрдЧрд╛, рд╡рд╣рд╛рдВ рдЕрдкрдирд╛ рдХрд╛рд░реНрдб рдбрд╛рд▓реЗрдВред
рдЖрдЦрд┐рд░ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛрдЧрд╛: рдорд╢реАрди рдЖрдкрдХрд╛ рдХрд╛рд░реНрдб рдЕрдВрджрд░ рдЦреАрдВрдЪ рд▓реЗрдЧреАред

рддреАрд╕рд░рд╛ рдХрджрдо: рдкрд┐рди рдирдВрдмрд░ рдбрд╛рд▓рдирд╛
рдкрд╣рд▓реЗ рдХреНрдпрд╛ рдХрд░реЗрдВ: рдорд╢реАрди рдкрд░ рд▓рд┐рдЦрд╛ рдЖрдПрдЧрд╛ "рдХреГрдкрдпрд╛ рдЕрдкрдирд╛ рдкрд┐рди рдирдВрдмрд░ рдбрд╛рд▓реЗрдВ"ред
рдлрд┐рд░ рдХреНрдпрд╛ рдХрд░реЗрдВ: рдЕрдкрдирд╛ 4 рдЕрдВрдХ рдХрд╛ рдЧреБрдкреНрдд рдирдВрдмрд░ (рдкрд┐рди) рдбрд╛рд▓реЗрдВред рдзреНрдпрд╛рди рд░рдЦреЗрдВ, рдЗрд╕реЗ рдХрд┐рд╕реА рдХреЛ рди рджрд┐рдЦрд╛рдПрдВред
рдЖрдЦрд┐рд░ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛрдЧрд╛: рдорд╢реАрди рдЖрдкрдХреЛ рдЕрдЧрд▓реЗ рд╕реНрдХреНрд░реАрди рдкрд░ рд▓реЗ рдЬрд╛рдПрдЧреА рдЬрд╣рд╛рдВ рд╡рд┐рдХрд▓реНрдк рджрд┐рдЦреЗрдВрдЧреЗред

рдЪреМрдерд╛ рдХрджрдо: "рдкреИрд╕реЗ рдирд┐рдХрд╛рд▓реЗрдВ" рдХрд╛ рд╡рд┐рдХрд▓реНрдк рдЪреБрдирдирд╛
рдкрд╣рд▓реЗ рдХреНрдпрд╛ рдХрд░реЗрдВ: рд╕реНрдХреНрд░реАрди рдкрд░ рдХрдИ рдмрдЯрди рдпрд╛ рд╡рд┐рдХрд▓реНрдк рджрд┐рдЦреЗрдВрдЧреЗред
рдлрд┐рд░ рдХреНрдпрд╛ рдХрд░реЗрдВ: "рдкреИрд╕реЗ рдирд┐рдХрд╛рд▓реЗрдВ" рдпрд╛ "Cash Withdrawal" рд╡рд╛рд▓рд╛ рдмрдЯрди рджрдмрд╛рдПрдВред
рдЖрдЦрд┐рд░ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛрдЧрд╛: рдорд╢реАрди рдЖрдкрд╕реЗ рдкреВрдЫреЗрдЧреА рдХрд┐ рдХрд┐рддрдиреЗ рдкреИрд╕реЗ рдирд┐рдХрд╛рд▓рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред

рдкрд╛рдВрдЪрд╡рд╛рдВ рдХрджрдо: рд░рд╛рд╢рд┐ рдЪреБрдирдирд╛ рдФрд░ рдкреИрд╕реЗ рд▓реЗрдирд╛
рдкрд╣рд▓реЗ рдХреНрдпрд╛ рдХрд░реЗрдВ: рдЬрд┐рддрдиреЗ рдкреИрд╕реЗ рдирд┐рдХрд╛рд▓рдиреЗ рд╣реИрдВ, рд╡реЛ рдЕрдВрдХ рдбрд╛рд▓реЗрдВ (рдЬреИрд╕реЗ: 500, 1000, 2000)ред
рдлрд┐рд░ рдХреНрдпрд╛ рдХрд░реЗрдВ: рдорд╢реАрди рдЖрдкрдХреЛ рдкреИрд╕реЗ рджреЗрдЧреА, рдЙрдиреНрд╣реЗрдВ рд▓реЗ рд▓реЗрдВред рдлрд┐рд░ рдЕрдкрдирд╛ рдХрд╛рд░реНрдб рднреА рд▓реЗ рд▓реЗрдВред
рдЖрдЦрд┐рд░ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛрдЧрд╛: рдорд╢реАрди рдПрдХ рдкрд░реНрдЪреА рднреА рджреЗрдЧреА рдЬрд┐рд╕рдореЗрдВ рд▓рд┐рдЦрд╛ рд╣реЛрдЧрд╛ рдХрд┐рддрдиреЗ рдкреИрд╕реЗ рдирд┐рдХрд╛рд▓реЗ рдФрд░ рдЖрдкрдХреЗ рдЦрд╛рддреЗ рдореЗрдВ рдХрд┐рддрдиреЗ рдмрдЪреЗред рдкрд░реНрдЪреА рдФрд░ рдкреИрд╕реЗ рджреЛрдиреЛрдВ рд▓реЗ рд▓реЗрдВ рдФрд░ рдмрд╛рд╣рд░ рдЖ рдЬрд╛рдПрдВред

рдпрд╛рдж рд░рдЦреЗрдВ:
- рдЕрдкрдирд╛ рдкрд┐рди рдирдВрдмрд░ рдХрднреА рдХрд┐рд╕реА рдХреЛ рди рдмрддрд╛рдПрдВ
- ATM рд╕реЗ рдкреИрд╕реЗ рдирд┐рдХрд╛рд▓рддреЗ рд╕рдордп рдЖрд╕рдкрд╛рд╕ рджреЗрдЦрддреЗ рд░рд╣реЗрдВ
- рдЕрдЧрд░ рдХреЛрдИ рдкрд░реЗрд╢рд╛рдиреА рд╣реЛ, рддреЛ рддреБрд░рдВрдд рдмреИрдВрдХ рдореЗрдВ рдмрддрд╛рдПрдВ""",
                    "timestamp": datetime.now().isoformat()
                }
            }
            self.save_cache("financial", basic_financial)
    
    def get_emergency_cache_file(self):
        """Get or create emergency assistance cache file"""
        cache_path = self.get_cache_path("emergency")
        if not os.path.exists(cache_path):
            emergency_data = {
                hashlib.md5("emergency numbers".encode()).hexdigest(): {
                    "query": "emergency numbers",
                    "response": """рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдирдВрдмрд░ (Emergency Numbers):

ЁЯУЮ рдкреБрд▓рд┐рд╕ (Police): 100
   - рдЪреЛрд░реА, рд▓рдбрд╝рд╛рдИ, рдЦрддрд░рд╛

ЁЯУЮ рдПрдореНрдмреБрд▓реЗрдВрд╕ (Ambulance): 108
   - рдмреАрдорд╛рд░реА, рдЪреЛрдЯ, рджреБрд░реНрдШрдЯрдирд╛

ЁЯУЮ рдлрд╛рдпрд░ рдмреНрд░рд┐рдЧреЗрдб (Fire): 101
   - рдЖрдЧ рд▓рдЧрдирд╛

ЁЯУЮ рдорд╣рд┐рд▓рд╛ рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди: 1091
   - рдорд╣рд┐рд▓рд╛рдУрдВ рдХреА рд╕реБрд░рдХреНрд╖рд╛, рдШрд░реЗрд▓реВ рд╣рд┐рдВрд╕рд╛

ЁЯУЮ рдмрд╛рд▓ рд╣реЗрд▓реНрдкрд▓рд╛рдЗрди: 1098
   - рдмрдЪреНрдЪреЛрдВ рдХреА рд╕рдорд╕реНрдпрд╛, рдЧреБрдо рдмрдЪреНрдЪреЗ

ЁЯУЮ рд╕рд╛рдЗрдмрд░ рдХреНрд░рд╛рдЗрдо: 1930
   - рдСрдирд▓рд╛рдЗрди рдзреЛрдЦрд╛рдзрдбрд╝реА, UPI рдлреНрд░реЙрдб

ЁЯУЮ рдЖрдкрджрд╛ рдкреНрд░рдмрдВрдзрди: 1078
   - рдмрд╛рдврд╝, рднреВрдХрдВрдк, рддреВрдлрд╛рди

ЁЯУЮ рдХрд┐рд╕рд╛рди рдХреЙрд▓ рд╕реЗрдВрдЯрд░: 1800-180-1551
   - рдлрд╕рд▓ рдХреА рд╕рдорд╕реНрдпрд╛, рдХреГрд╖рд┐ рд╕рд▓рд╛рд╣""",
                    "timestamp": datetime.now().isoformat()
                },
                hashlib.md5("рд╕рд╛рдВрдк рдиреЗ рдХрд╛рдЯ рд▓рд┐рдпрд╛".encode()).hexdigest(): {
                    "query": "рд╕рд╛рдВрдк рдиреЗ рдХрд╛рдЯ рд▓рд┐рдпрд╛",
                    "response": """ЁЯЪи рддреБрд░рдВрдд рдПрдореНрдмреБрд▓реЗрдВрд╕ рдмреБрд▓рд╛рдПрдВ: 108
        
рдкрд╣рд▓реА рд╕рд╣рд╛рдпрддрд╛:
1. рдмрд┐рд▓реНрдХреБрд▓ рд╢рд╛рдВрдд рд░рд╣реЗрдВ, рд╣рд┐рд▓реЗрдВ-рдбреБрд▓реЗрдВ рдирд╣реАрдВ
2. рдХрд╛рдЯреА рд╣реБрдИ рдЬрдЧрд╣ рдХреЛ рджрд┐рд▓ рд╕реЗ рдиреАрдЪреЗ рд░рдЦреЗрдВ
3. рдХрд╕рдХреЗ рдкрдЯреНрдЯреА рди рдмрд╛рдВрдзреЗрдВ
4. рдЬрдбрд╝реА-рдмреВрдЯреА рдкрд░ рд╕рдордп рдмрд░реНрдмрд╛рдж рди рдХрд░реЗрдВ
5. рд╕реАрдзреЗ рдЕрд╕реНрдкрддрд╛рд▓ рдЬрд╛рдПрдВ
        
тП░ рдЬрд▓реНрджреА рдХрд░реЗрдВ! рджреЗрд░ рдордд рдХрд░реЗрдВ!""",
                    "timestamp": datetime.now().isoformat()
                }
            }
            self.save_cache("emergency", emergency_data)
    
    def get_agriculture_cache_file(self):
        """Get or create agriculture cache file"""
        cache_path = self.get_cache_path("agriculture")
        if not os.path.exists(cache_path):
            # This will be populated from crop_data folder in the future
            self.save_cache("agriculture", {})
    
    def get_schemes_cache_file(self):
        """Get or create schemes cache file"""
        cache_path = self.get_cache_path("schemes")
        if not os.path.exists(cache_path):
            # This will be populated from scheme_data folder in the future
            self.save_cache("schemes", {})
    
    def get_calculator_cache_file(self):
        """Get or create calculator cache file"""
        cache_path = self.get_cache_path("calculator")
        if not os.path.exists(cache_path):
            # Simple calculations that can be done offline
            calc_data = {
                hashlib.md5("100 рдЧреБрдирд╛ 5".encode()).hexdigest(): {
                    "query": "100 рдЧреБрдирд╛ 5",
                    "response": "100 ├Ч 5 = 500",
                    "timestamp": datetime.now().isoformat()
                },
                hashlib.md5("1000 рдореЗрдВ рд╕реЗ 200 рдШрдЯрд╛".encode()).hexdigest(): {
                    "query": "1000 рдореЗрдВ рд╕реЗ 200 рдШрдЯрд╛",
                    "response": "1000 - 200 = 800",
                    "timestamp": datetime.now().isoformat()
                }
            }
            self.save_cache("calculator", calc_data)

# Example usage
if __name__ == "__main__":
    offline_mgr = OfflineMode()
    
    # Example of getting a response in offline mode
    response, from_cache = offline_mgr.get_response("financial", "рдмреИрдВрдХ рдЕрдХрд╛рдЙрдВрдЯ рдХреИрд╕реЗ рдЦреЛрд▓реЗрдВ", None)
    print(f"Response from cache: {from_cache}")
    print(response)